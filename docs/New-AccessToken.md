---
external help file: PsOauth2-help.xml
Module Name: psoauth2
online version:
schema: 2.0.0
---

# New-AccessToken

## SYNOPSIS
This function will help you to generate tokens (Access/Refresh/Id) with multiple OAUTH2 flows.

## SYNTAX

### AuthCodeFlow
```
New-AccessToken -Resource <Guid> -Scope <String> [-RedirectUri <String>] -TenantId <Guid> [-AuthCodeFlow]
 [-WithoutCache] [-Secret <String>] [<CommonParameters>]
```

### ClientCredentialFlowSecret
```
New-AccessToken -Resource <Guid> -Scope <String> [-RedirectUri <String>] -TenantId <Guid> [-WithoutCache]
 -Secret <String> [-ClientCredentialFlow] [<CommonParameters>]
```

### ClientCredentialFlowCert
```
New-AccessToken -Resource <Guid> -Scope <String> [-RedirectUri <String>] -TenantId <Guid> [-WithoutCache]
 -CertificatePath <Object> [-ClientCredentialFlow] [<CommonParameters>]
```

### DeviceCodeFlow
```
New-AccessToken -Resource <Guid> -Scope <String> [-RedirectUri <String>] -TenantId <Guid> [-WithoutCache]
 [-DeviceCodeFlow] [<CommonParameters>]
```

## DESCRIPTION
This function will help you to generate tokens (Access/Refresh/Id) with multiple OAUTH2 flows.
This command is an abstraction of the complexity
generated by the multiple flows.
This function will check is a cache exist and use it except if you decide to use the withoucache parameter.
In addition, you can decide to use this function in conjunction with secret.
WARNING: This module is mainly for learning OAUTH/OIDC purpose.
You should consider using the MSAL.PS module if you plan to do OAUTH in production.

## EXAMPLES

### EXAMPLE 1
```
$ClientId = 'd3537907-7a6f-54be-8a83-601d70feec72'
    $TenantId = 'e192cada-b64d-4cfc-8b90-d14338b2c7ec'
```

$Splatting = @{
        Resource     = $ClientId
        TenantId     = $TenantId
        Scope        = 'https://graph.microsoft.com/.default openid offline_access'
        RedirectUri  = 'https://login.microsoftonline.com/common/oauth2/nativeclient'
        AuthCodeFlow = $true
        verbose      = $true
    }

"will authenticate using the auth code flow."

### EXAMPLE 2
```
$ClientId = 'd3537907-7a6f-54be-8a83-601d70feec72'
    $TenantId = 'e192cada-b64d-4cfc-8b90-d14338b2c7ec'
```

$Splatting = @{
        Resource     = $ClientId
        TenantId     = $TenantId
        Scope        = 'https://graph.microsoft.com/.default openid offline_access'
        RedirectUri  = 'https://login.microsoftonline.com/common/oauth2/nativeclient'
        Secret       = 'mysecret'
        AuthCodeFlow = $true
        verbose      = $true
    }

"will authenticate using the auth code flow."

## PARAMETERS

### -Resource
Specify the resource you try to reach (clientId)

```yaml
Type: Guid
Parameter Sets: (All)
Aliases:

Required: True
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### -Scope
Specify the scope

```yaml
Type: String
Parameter Sets: (All)
Aliases:

Required: True
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### -RedirectUri
Specify the RedirectUri of the application

```yaml
Type: String
Parameter Sets: (All)
Aliases:

Required: False
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### -TenantId
Specify the tenantId (with guid)

```yaml
Type: Guid
Parameter Sets: (All)
Aliases:

Required: True
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### -AuthCodeFlow
Specify you want to authenticate using the AuthCodeFlow

```yaml
Type: SwitchParameter
Parameter Sets: AuthCodeFlow
Aliases:

Required: True
Position: Named
Default value: False
Accept pipeline input: False
Accept wildcard characters: False
```

### -WithoutCache
Specify you don't want to use the local cache

```yaml
Type: SwitchParameter
Parameter Sets: (All)
Aliases:

Required: False
Position: Named
Default value: False
Accept pipeline input: False
Accept wildcard characters: False
```

### -Secret
Specify the secret of the clientId

```yaml
Type: String
Parameter Sets: AuthCodeFlow
Aliases:

Required: False
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

```yaml
Type: String
Parameter Sets: ClientCredentialFlowSecret
Aliases:

Required: True
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### -CertificatePath
Specify the certificate to use for the authentication.
Should come from a installed pfx under the form "Cert:\CurrentUser\My\\\<cert thumbprint\>"

```yaml
Type: Object
Parameter Sets: ClientCredentialFlowCert
Aliases:

Required: True
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### -DeviceCodeFlow
Specify you want to authenticate using the DeviceCodeFlow

```yaml
Type: SwitchParameter
Parameter Sets: DeviceCodeFlow
Aliases:

Required: True
Position: Named
Default value: False
Accept pipeline input: False
Accept wildcard characters: False
```

### -ClientCredentialFlow
Specify you want to authenticate using the ClientCredentialFlow

```yaml
Type: SwitchParameter
Parameter Sets: ClientCredentialFlowSecret, ClientCredentialFlowCert
Aliases:

Required: True
Position: Named
Default value: False
Accept pipeline input: False
Accept wildcard characters: False
```

### CommonParameters
This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see [about_CommonParameters](http://go.microsoft.com/fwlink/?LinkID=113216).

## INPUTS

## OUTPUTS

## NOTES
VERSION HISTORY
1.0 | 2021/05/05 | Francois LEON
    initial version
POSSIBLE IMPROVEMENT
    - Add Certificate authentication

## RELATED LINKS
